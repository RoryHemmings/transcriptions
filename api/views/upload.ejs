<head>
  <%- include('./partials/head'); %>

</head>

<body class="d-flex flex-column min-vh-100">
  <%- include('./partials/navbar') %>
  <main class="container">
    <h1 class="text-center">
      Upload
    </h1>
    <p class="text-center">New Transcription</p>
    <form action="/upload" method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" class="form-control" name="title" id="title" aria-describedby="helpId" placeholder="Title (1-100 characters)">
      </div>
      <div class="form-group">
        <label for="tags">Tags</label>
        <input type="text" class="form-control" name="tags" id="tags" placeholder="Tags" />
        <p class="text-muted">Seperate tags by commas i.e. <br> drums, fast, jazz </p>
      </div>
      <div class="form-group">
        <div class="form-group">
          <label for="description">Description</label>
          <textarea type="text" class="form-control" name="description" id="description" aria-describedby="helpId"
            placeholder="description (5000 characters max)"></textarea>
        </div>
      </div>
      <div class="form-group">
        <label for="file">Upload file</label>
        <input type="file" class="form-control-file" name="file" id="file" aria-describedby="fileHelpId"
          onchange="handleImageUpload(event)">
        <small id="fileHelpId" class="form-text text-muted">Upload an image or pdf</small>

        <% if (messages.error) { %>
        <p class="text-danger"><%= messages.error %></p>
        <% } %>
        <button type="submit" class="btn btn-primary">Upload</button>
      </div>
    </form>
  </main>

  <footer class="mt-auto">
    <%- include('./partials/footer'); %>
  </footer>

  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/browser-image-compression@1.0.13/dist/browser-image-compression.js"></script>
  <script>
    async function handleImageUpload(event) {
      // let file = event.target.files[0];
      // console.log(file.size)
      // let extension = file.name.substring(file.name.lastIndexOf('.')+1);

      // // Make sure that file is an image before trying to compress it
      // // Compression on pdfs is unnessecary and even if its not, then 
      // // I couldn't find an easy way of doing it
      // if (extension == "png" || extension == "jpg" || extension == "jpeg") {
      //   const options = {
      //     maxSizeMB: 2,
      //     useWebWorker: true
      //   }

      //   try {
      //     const compressedFile = await imageCompression(file, options);
      //     console.log(compressedFile.size)
      //   } catch (err) {
      //     console.error(err)
      //   }
      // }
    }
  </script>

</body>